import socket
from binascii import unhexlify
import time

#flag{6974736a7573746c696b65696e7468656d6f76696573}

def recv_until(s, s2):
    text = ""
    while text.find(s2) == -1:
        text += s.recv(1024)
    return text

#hexa
charset = [c for c in range(48,58)]
charset += [c for c in range(97,103)]
wrong='Nope.'


flag=""
base=""
payload=""

#will just guess the flag itself
for c in range(0xc0, 0xc0+50):
    base += chr(0xc0+50)
    base += chr(c%256)
base = '666c61677b'+base[10:98]+'7d'

#got an alert(120), gotta reset but lazy to optimize
for i in range(5, 49):
    s=socket.create_connection(('wildwildweb.fluxfingers.net', 1412))
    recv_until(s, "guess>")
    found=False
    for c1 in charset: #bruteforce 1 char
        for c2 in charset :
            payload = list(base)
            payload[2*i] = chr(c1)
            payload[2*i+1] = chr(c2)
            payload = "".join(payload)

            s.send(payload+'\n')
            msg = s.recv(4096)
            if msg.find('flag') != -1: #good message
                c = unhexlify(chr(c1)+chr(c2))
                if ord(c) not in charset: #if by any chance we did not found an hexa
                    print 'problem: '+c
                    raw_input()
                flag+=c
                print "found: " + flag
                found=True
                break
            s.recv(4096)
        if found:
            break
    s.close
    time.sleep(1) #sleep to prevent ddos, had some network issues

print 'flag{' + flag + '}'
